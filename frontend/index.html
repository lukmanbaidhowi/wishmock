<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>wishmock Admin</title>
    <link rel="stylesheet" href="/app/styles.css" />
  </head>
  <body>
    <header>
      <h1>wishmock Admin</h1>
      <nav>
        <a href="#status">Status</a>
        <a href="#upload">Upload</a>
        <a href="#services">Services</a>
      </nav>
    </header>

    <main>
      <div id="snackbar" class="snackbar" role="status" aria-live="polite" style="display:none">
        <span id="snackbarText"></span>
        <button id="snackbarClose" class="snackbar-close" aria-label="Close">Ã—</button>
      </div>
      <section id="status" class="card">
        <h2>Status</h2>
        <button id="refreshStatus">Refresh</button>
        <div class="status-grid">
          <div>
            <h3>gRPC Ports</h3>
            <div class="panel">
              <div>Plaintext: <code id="grpcPlaintextPort">-</code></div>
              <div>TLS enabled: <code id="grpcTlsEnabled">-</code></div>
              <div>TLS port: <code id="grpcTlsPort">-</code></div>
              <div id="grpcTlsErrorWrap" style="display:none">TLS error: <span id="grpcTlsError" class="muted">-</span></div>
            </div>
          </div>
          <div>
            <h3>Loaded Services</h3>
            <ul id="services"></ul>
          </div>
          <div>
            <h3>Rules (stubs)</h3>
            <ul id="rules"></ul>
          </div>
          <div>
            <h3>Protos Loaded</h3>
            <ul id="protosLoaded"></ul>
          </div>
          <div>
            <h3>Protos Skipped</h3>
            <ul id="protosSkipped"></ul>
          </div>
        </div>
      </section>

      <section id="upload" class="card">
        <h2>Upload</h2>
        <div class="upload-grid">
          <form id="uploadProto" class="panel dropzone">
            <h3>.proto</h3>
            <input type="file" id="protoFile" accept=".proto" />
            <div class="hint selected-file" id="protoFileName"></div>
            <div class="hint drop-hint">Drag & drop a .proto file here</div>
            <button type="submit">Upload .proto</button>
            <p class="hint">Saves to /protos and triggers rebuild on file change.</p>
          </form>

          <form id="uploadProtoAtPath" class="panel dropzone">
            <h3>.proto (to subfolder)</h3>
            <label for="protoRelPath" class="muted">Relative path under protos/ (e.g., common/types.proto)</label>
            <input type="text" id="protoRelPath" placeholder="common/types.proto" />
            <input type="file" id="protoFileAtPath" accept=".proto" />
            <div class="hint selected-file" id="protoFileAtPathName"></div>
            <div class="hint drop-hint">Drag & drop a .proto file here</div>
            <button type="submit">Upload to path</button>
            <p class="hint">Saves under <code>protos/&lt;path&gt;</code>. Path must be relative and end with <code>.proto</code>.</p>
          </form>

          <form id="uploadRule" class="panel">
            <h3>Rule (YAML/JSON)</h3>
            <input type="file" id="ruleFile" accept=".yaml,.yml,.json" />
            <div class="hint selected-file" id="ruleFileName"></div>
            <button type="submit">Upload rule</button>
            <p class="hint">Saves to /rules and reloads immediately.</p>
          </form>
        </div>
      </section>

      <section id="services" class="card">
        <h2>Services & Schemas</h2>
        <div class="services-grid">
          <div>
            <div class="row">
              <button id="refreshServices">Refresh Services</button>
              <button id="expandAllServices" title="Expand all services">Expand all</button>
              <button id="collapseAllServices" title="Collapse all services">Collapse all</button>
              <span class="hint">Click a type to inspect schema.</span>
            </div>
            <div id="servicesList" class="panel"></div>
          </div>
          <div>
            <h3>Schema Inspector</h3>
            <div id="schemaPanel" class="panel">
              <div id="schemaEmpty" class="hint">Select a request/response type on the left.</div>
              <div id="schemaContent" style="display:none"></div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <small>
        Built for wishmock admin API. Open <code>/admin/status</code> for raw JSON.
      </small>
    </footer>

    <script src="/app/dist/app.js" type="module"></script>
  </body>
  </html>
